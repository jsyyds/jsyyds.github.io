---
title: JavaScript æ¨¡å—åŒ–
description: JS æ¨¡å—åŒ–å‘å±•çš„å†ç¨‹
img: https://images.unsplash.com/photo-1611347022329-4e3bceb508a7?ixid=MnwxMjA3fDB8MHxzZWFyY2h8NHx8YnVpbGRpbmclMjBibG9ja3xlbnwwfHwwfHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80
alt: JavaScript æ¨¡å—åŒ–
tags:
  - javascript
  - web development
---
## Javascript æ¨¡å—ç»„ç»‡

### è¯­è¨€çš„æ¨¡å—æ”¯æŒ

```
java: import

C#: using

css: @import

JavaScript SE5: None!

JavaScript ES6: module
```

## æ¨¡å—

æ¨¡å—èŒè´£ï¼š

- å°è£…å®ç°

- æš´éœ²æ¥å£

- å£°æ˜ä¾èµ–

### åæ¨¡å¼ï¼ˆæ— æ¨¡å—)

**Anti-Pattern**

```js
// math.js
function add (a, b) {
    return a + b
}
function sub (a, b) {
    return a - b
}
```

å­˜åœ¨çš„é—®é¢˜ï¼š

1. å°è£…æ€§æ— 

2. æ¥å£ç»“æ„ä¸æ˜æ˜¾

```js
// caculator.js
var action = "add";

function compute (a, b) {
    switch (action) {
        case "add": return add(a, b)
        case "sub": return sub(a, b)
    }
}
```

å­˜åœ¨çš„é—®é¢˜ï¼š

1. æ²¡æœ‰ä¾èµ–å£°æ˜

2. ä½¿ç”¨å…¨å±€çŠ¶æ€

### å­—é¢é‡

**Object Literal**

```js
// math.js
var math = {
    add: function add (a, b) {
        return a + b
    },
    sub: function sub (a, b) {
        return a - b
    }
}
```

ä¼˜ç‚¹ï¼š

1. ç»“æ„æ€§å¥½

ä¸è¶³ï¼š

2. æ²¡æœ‰è®¿é—®æ§åˆ¶

```js
// caculator.js
var caculator = {
    action: 'add',
    compute: function compute (a, b) {
        switch (action) {
            case "add": return add(a, b)
            case "sub": return sub(a, b)
        }
    }
}
```

ä¸è¶³ï¼š

1. åŒæ ·æ²¡æœ‰ä¾èµ–å£°æ˜

2. æ— æ³•è¡¨æ˜ä¸€ä¸ªå˜é‡æ˜¯ç§æœ‰çš„

### IIFE

**Immediately-invoked Function Expression**

è‡ªæ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼

```js
// caculator-1.js
var caculator = (function(){
    var action = "add"

    return {
        compute: function (a, b) {
            switch (action) {
                case "add": return add(a, b)
                case "sub": return sub(a, b)
            }
        }
    }
})()
```

ä¼˜åŠ¿ï¼š

1. è®¿é—®æ§åˆ¶

ä¸è¶³ï¼š

2. æ— ä¾èµ–å£°æ˜

```js
// caculator-2.js
var caculator = (function(m) {
    var action = "add"
    function compute (a, b) {
        switch (action) {
            case "add": return m.add(a, b)
            case "sub": return m.sub(a, b)
        }
    }
    return {
        compute: compute
    }
})(math)
```

ä¼˜åŠ¿ï¼š

1. æ˜¾ç¤ºä¾èµ–å£°æ˜

ä¸è¶³ï¼š

2. ä»ç„¶æ±¡æŸ“äº†å…¨å±€å˜é‡

3. å¿…é¡»æ‰‹åŠ¨è¿›è¡Œä¾èµ–ç®¡ç†

### å‘½åç©ºé—´

**Naming Space**

```js
// math.js
namespace("math", [], function(){
    function add (a, b) { return a + b }
    function sub (a, b) { return a - b }

    return {
        add: add,
        sub: sub
    }
})
```

```js
// caculator.js
namespace("caculator", ["math"], function(m){
    // ["math"]: ä¾èµ–å£°æ˜
    // function(m): ä¾èµ–æ³¨å…¥
    var action = "add"
    function compute (a, b) {
        reutrn m[action](a, b)
    }
    return {
        compute: compute
    }
})
```

```js
// namespace
var namespace = (function(){
    var cache = {} // ç¼“å­˜æ‰€æœ‰æ¨¡å—
    function createModule(name, deps, definition){ // å‚æ•°ï¼šæ¨¡å—åï¼Œä¾èµ–åˆ—è¡¨ï¼Œå®šä¹‰
        if(arguments.length === 1) return cache[name]

        deps = deps.map(function(depName){ // å¿…é¡»å…ˆå–å¾—æ‰€æœ‰ä¾èµ–çš„æ¨¡å—
            return ns(depName)
        })

        // åˆå§‹åŒ–æ¨¡å—å¹¶è¿”å›
        cache[name] = definition.apply(null, deps)

        return cache[name];
    }
    return createModule
})()
```

### ä¾èµ–ç®¡ç†

**dependency manage**

<img src="/img/æŠ€æœ¯é€‰å‹_ä¾èµ–ç®¡ç†.jpg" alt="ç‰ˆæœ¬ç®¡ç†_äººè‚‰_VCS" width="926" height="672">

```html
<body>
    <script src="module5.js"></script>
    <script src="module4.js"></script>

    <script src="module1.js"></script>
    <script src="module3.js"></script>

    <script src="module2.js"></script>
</body>
```

<img src="/img/æŠ€æœ¯é€‰å‹_ä¾èµ–ç®¡ç†1.jpg" alt="ç‰ˆæœ¬ç®¡ç†_äººè‚‰_VCS" width="1699" height="733">

ğŸ˜‚ğŸ˜‚ğŸ˜‚

åœæ­¢äººå·¥å¤„ç†ä¾èµ–å…³ç³»ï¼Œäº¤ç»™æ¨¡å—ç³»ç»Ÿå¤„ç†ã€‚

## æ¨¡å—ç³»ç»Ÿ

æ¨¡å—ç³»ç»ŸèŒè´£ï¼š

- ä¾èµ–ç®¡ç†ï¼š*åŠ è½½/åˆ†æ/æ³¨å…¥/åˆå§‹åŒ–*

- å†³å®šæ¨¡å—å†™æ³•

### Commonjs/module

**A module spec for javascript outside the browser**

```js
// math.js
function add (a, b) {
    return a + b
}
function sub (a, b) {
    return a - b
}

export.add = add
export.sub = sub
```

```js
// caculator.js
var math = require("./math"); // ä¾èµ–å£°æ˜

function Caculator (container) {
    this.left = container.querySelector(".j-left");
    this.right = container.querySelector(".j-right");
    this.add = container.querySelector(".j-add");
    this.result = container.querySelector(".j-result");

    this.add.addEventListener('click', this.compute.bind(this));
}

Caculator.prototype.compute = function(){
    this.result.textContent = math.add(+this.left.value, +this.right.value)
}

exports.Caculator = Caculator; // æ¥å£æš´éœ²
```

ä¼˜ç‚¹ï¼š

- ä¾èµ–ç®¡ç†æˆç†Ÿå¯é 

- ç¤¾åŒºæ´»è·ƒï¼Œè§„èŒƒæ¥å—åº¦é«˜

- è¿è¡Œæ—¶æ”¯æŒï¼Œæ¨¡å—å®šä¹‰éå¸¸ç®€å•

- æ–‡ä»¶çº§åˆ«çš„æ¨¡å—ä½œç”¨åŸŸéš”ç¦»

- å¯ä»¥å¤„ç†å¾ªç¯ä¾èµ–

ç¼ºç‚¹ï¼š

- ä¸æ˜¯æ ‡å‡†ç»„ç»‡çš„è§„èŒƒ

- åŒæ­¥çš„ requireï¼Œæ²¡æœ‰è€ƒè™‘æµè§ˆå™¨ç¯å¢ƒ

  - å¯ä»¥é€šè¿‡æ‰“åŒ…å·¥å…·åœ¨å‰ç«¯è¿è¡Œ

### AMD

**Asynchronous Module Definition**

```js
// math.js
define([], function(){
    function add (a, b) {
        return a + b
    }
    function sub (a, b) {
        return a - b
    }

    return { // æ¥å£æš´éœ²
        add: add,
        sub: sub
    }
})
```

```js
// caculator.js
define(["./math"], function(math){ // ä¾èµ–å£°æ˜ã€ä¾èµ–æ³¨å…¥
    function Caculator (container) {
        this.left = container.querySelector(".j-left");
        this.right = container.querySelector(".j-right");
        this.add = container.querySelector(".j-add");
        this.result = container.querySelector(".j-result");

        this.add.addEventListener('click', this.compute.bind(this));
    }

    Caculator.prototype.compute = function () {}

    return {
        Caculator: Caculator
    }
})
```

**Simplified CommonJS wrapping**

```js
define(function(require, exports){
    var math = require("./math"); // ä¾èµ–å£°æ˜

    function Caculator(container){
        this.left = container.querySelector(".j-left");
        this.right = container.querySelector(".j-right");
        this.add = container.querySelector(".j-add");
        this.result = container.querySelector(".j-result");

        // ç•¥...
    }

    Caculator.prototype.compute = function () {/**/}

    exports.Caculator = Caculator; // æš´éœ²æ¥å£
})
```

**Loader Plugins** Draft

å®Œæ•´ç»„ä»¶ = ç»“æ„ + é€»è¾‘ + æ ·å¼

```js
define(["regularjs", "text!path/to/foo.html", "css!path/to/style.css"], function(Regular, template){
    // "text!path/to/foo.html": æ–‡æœ¬ç±»èµ„æºä¾èµ–
    // "css!path/to/style.css": åŠ è½½ css èµ„æº
    // é€šè¿‡ text æ’ä»¶ï¼Œtemplate æ˜¯é€šè¿‡ ajax åŠ è½½çš„çº¯æ–‡æœ¬

    Component = Regular.extend({
        template: template, // template: å·²ç»æ˜¯å­—ç¬¦ä¸²æ–‡æœ¬
        show: function(){},
        hide: function(){}
    })

    // ç•¥...

    return Component;
})
```

ä¼˜ç‚¹ï¼š

- ä¾èµ–ç®¡ç†æˆç†Ÿå¯é 

- ç¤¾åŒºæ´»è·ƒï¼Œè§„èŒƒæ¥å—åº¦é«˜

- ä¸“ä¸º**å¼‚æ­¥ IO ç¯å¢ƒ**æ‰“é€ ï¼Œé€‚åˆæµè§ˆå™¨ç¯å¢ƒ

- æ”¯æŒç±»ä¼¼ Commonjs çš„ä¹¦å†™æ–¹å¼

- é€šè¿‡æ’ä»¶ API å¯æ”¯æŒåŠ è½½é js èµ„æº

- æˆç†Ÿçš„æ‰“åŒ…æ„å»ºå·¥å…·ï¼Œå¹¶å¯ç»“åˆæ’ä»¶

ç¼ºç‚¹ï¼š

- æ¨¡å—å®šä¹‰ç¹çï¼Œéœ€è¦é¢å¤–åµŒå¥—

- åªæ˜¯**åº“çº§åˆ«**çš„æ”¯æŒï¼Œéœ€è¦å¼•å…¥é¢å¤–åº“

- æ— æ³•å¤„ç†å¾ªç¯ä¾èµ–

- æ— æ³•å®ç°æ¡ä»¶åŠ è½½

### ES6 module

**JavaScript module definition for future**

```js
// math.js
function add (a, b) {
    return a + b;
}
function sub (a, b) {
    return a - b;
}

export {add, sub} // export å…³é”®å­— æ¥å£ç»™æš´éœ²
```

```js
// caculator.js
import {add} from './math'; // import å…³é”®å­— å¼•å…¥ä¾èµ–

class Cacularot { // es6 æœ‰äº† class å…³é”®å­—
    constructor(container){}
    compute(){
        this.result.textContent = add(+this.left.value, +this.right.value)
    }
}

export {Caculator}
```

ä¼˜ç‚¹ï¼š

- æ˜¯çœŸæ­£çš„è§„èŒƒï¼Œæœªæ¥çš„æ¨¡å—æ ‡å‡†

- è¯­è¨€çº§åˆ«çš„å…³é”®å­—æ”¯æŒ

- é€‚åº”æ‰€æœ‰ JavaScript è¿è¡Œæ—¶ï¼ŒåŒ…æ‹¬æµè§ˆå™¨

- åŒæ ·å¯å¤„ç†å¾ªç¯ä¾èµ–

ç¼ºç‚¹ï¼š

- è§„èŒƒå¹¶æœªåˆ°ç¨³å®šçº§åˆ«

- åŸºæœ¬è¿˜æ²¡æœ‰æµè§ˆå™¨æ”¯æŒ

- é²œæœ‰é¡¹ç›®ä½¿ç”¨ï¼Œå³ä½¿æœ‰å¤§é‡çš„ 6 to 5 çš„ transpiler

### Systemjs

**Universal dynamic module loader**

- æ”¯æŒåŠ è½½ AMD

- æ”¯æŒåŠ è½½ Commonjs

- æ”¯æŒåŠ è½½ ES6

- æ”¯æŒ Transpilerï¼Œå¯æ”¯æŒä»»æ„èµ„æº